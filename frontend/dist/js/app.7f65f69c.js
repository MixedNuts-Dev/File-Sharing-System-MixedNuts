(function(){"use strict";var e={7242:function(e,t,s){var l=s(5130),o=s(6768);const a={id:"app"};function r(e,t,s,l,r,i){const n=(0,o.g2)("FileManager");return(0,o.uX)(),(0,o.CE)("div",a,[t[0]||(t[0]=(0,o.Lk)("header",{class:"app-header"},[(0,o.Lk)("h1",null,"MixedNuts ファイル共有システム")],-1)),(0,o.Lk)("main",null,[(0,o.bF)(n)]),t[1]||(t[1]=(0,o.Lk)("footer",{class:"app-footer"},[(0,o.Lk)("p",null,"© 2025 MixedNuts ファイル共有システム. All rights reserved.")],-1))])}var i=s(4232);const n={id:"app",class:"p-4"},d={key:0},c={key:0,class:"text-red-500 mt-2"},h={key:1,class:"new-year-container"},u={key:2},p={id:"system-updates",class:"p-4 mb-4 border rounded bg-gray-100"},m={key:0},w={class:"flex justify-between items-center"},f={key:2},g=["innerHTML"],v={key:1,class:"text-gray-500"},y={key:1},b=["innerHTML"],k={key:1,class:"text-gray-500"},F={class:"text-xl mb-2"},C={key:0,class:"mt-2"},x=["value"],E={key:1,class:"mt-2"},M={key:2,class:"mt-2"},L={class:"w-full bg-gray-200 rounded"},A={class:"mt-4"},U=["onClick"],N=["onClick"],X=["onClick"],$=["onClick"],I=["href"],T=["onClick"],S=["onClick"],P=["onClick"],R=["onClick"],_=["onClick"],j={key:3,class:"mt-4 border p-2"},O=["src"],H=["src"],z=["src"],D=["innerHTML"],Q=["innerHTML"],V=["src"],Y={key:6,class:"excel-preview p-4"},q={key:0,class:"mb-4"},K=["value"],J={id:"excelTableContainer"},W={id:"excelTable",class:"border-collapse w-full"},B={class:"row-number"},Z={key:4,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},G={class:"bg-white p-6 rounded shadow-md"},ee={class:"text-xl font-bold mb-4"},te={class:"flex justify-end"},se={key:5,class:"modal-overlay"},le={class:"edit-modal"},oe={class:"modal-buttons"},ae={key:6,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},re={class:"bg-white p-6 rounded shadow-md"},ie={class:"mb-2"},ne=["value"],de={class:"flex justify-end"};function ce(e,t){return(0,o.uX)(),(0,o.CE)("div",n,[e.loggedIn?e.showNewYear?((0,o.uX)(),(0,o.CE)("div",h,[t[31]||(t[31]=(0,o.Fv)('<div class="fireworks-container"><div class="c-firework"></div><div class="c-firework"></div><div class="c-firework"></div></div><h1 class="new-year-text">Happy New Year</h1>',2)),(0,o.Lk)("button",{onClick:t[5]||(t[5]=(...t)=>e.skipNewYear&&e.skipNewYear(...t)),class:"close-btn"},"Skip")])):((0,o.uX)(),(0,o.CE)("div",u,[(0,o.Lk)("div",p,[t[33]||(t[33]=(0,o.Lk)("h2",{class:"text-xl font-bold mb-4"},"直近のアップデート",-1)),e.isAdmin?((0,o.uX)(),(0,o.CE)("div",m,[(0,o.Lk)("div",w,[t[32]||(t[32]=(0,o.Lk)("span",{class:"font-semibold"},"管理者ページ",-1)),(0,o.Lk)("button",{onClick:t[6]||(t[6]=(...t)=>e.toggleEditMode&&e.toggleEditMode(...t)),class:(0,i.C4)(["px-4 py-2 rounded",e.isEditMode?"bg-green-500 text-white":"bg-blue-500 text-white"])},(0,i.v_)(e.isEditMode?"編集中":"編集"),3)]),e.isEditMode?(0,o.bo)(((0,o.uX)(),(0,o.CE)("textarea",{key:0,"onUpdate:modelValue":t[7]||(t[7]=t=>e.updateContent=t),class:"w-full h-32 border p-2 mt-2 bg-white text-black"},null,512)),[[l.Jo,e.updateContent]]):(0,o.Q3)("",!0),e.isEditMode?((0,o.uX)(),(0,o.CE)("button",{key:1,onClick:t[8]||(t[8]=(...t)=>e.saveUpdate&&e.saveUpdate(...t)),class:"bg-green-500 text-white px-4 py-2 mt-2"}," 保存 ")):((0,o.uX)(),(0,o.CE)("div",f,[e.renderedHtml?((0,o.uX)(),(0,o.CE)("div",{key:0,innerHTML:e.renderedHtml,class:"p-4 markdown-preview"},null,8,g)):((0,o.uX)(),(0,o.CE)("div",v,"アップデート情報はありません。"))]))])):((0,o.uX)(),(0,o.CE)("div",y,[e.renderedHtml?((0,o.uX)(),(0,o.CE)("div",{key:0,innerHTML:e.renderedHtml,class:"p-4 markdown-preview"},null,8,b)):((0,o.uX)(),(0,o.CE)("div",k,"アップデート情報はありません。"))]))]),(0,o.Lk)("h2",F,"ようこそ！, "+(0,i.v_)(e.username),1),(0,o.Lk)("button",{onClick:t[9]||(t[9]=(...t)=>e.logout&&e.logout(...t)),class:"bg-red-500 text-white px-4 py-2 mb-4"},"ログアウト"),e.currentFolder?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[10]||(t[10]=(...t)=>e.goToParent&&e.goToParent(...t)),class:"bg-gray-500 text-white px-4 py-2 mb-4"}," 前の階層へ戻る ")):(0,o.Q3)("",!0),(0,o.Lk)("div",null,[t[34]||(t[34]=(0,o.Lk)("h2",{class:"text-xl mb-2"},"フォルダ作成",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=t=>e.newFolderName=t),placeholder:"フォルダ名",class:"border p-2 mr-2"},null,512),[[l.Jo,e.newFolderName]]),(0,o.Lk)("button",{onClick:t[12]||(t[12]=(...t)=>e.createFolder&&e.createFolder(...t)),class:"bg-green-500 text-white px-4 py-2"},"作成"),e.folderMessage?((0,o.uX)(),(0,o.CE)("p",C,(0,i.v_)(e.folderMessage),1)):(0,o.Q3)("",!0)]),t[38]||(t[38]=(0,o.Lk)("h2",{class:"text-xl mb-2 mt-4"},"ファイルアップロード",-1)),(0,o.Lk)("input",{type:"file",onChange:t[13]||(t[13]=(...t)=>e.onFileChange&&e.onFileChange(...t)),ref:"fileInput",class:"border p-2 mr-2"},null,544),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[14]||(t[14]=t=>e.selectedUploadFolder=t),class:"border p-2 mr-2"},[t[35]||(t[35]=(0,o.Lk)("option",{value:""},"ルート",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.allFolders,(e=>((0,o.uX)(),(0,o.CE)("option",{key:e,value:e},(0,i.v_)(e),9,x)))),128))],512),[[l.u1,e.selectedUploadFolder]]),(0,o.Lk)("button",{onClick:t[15]||(t[15]=(...t)=>e.uploadFile&&e.uploadFile(...t)),class:"bg-green-500 text-white px-4 py-2"},"アップロード"),e.uploadMessage?((0,o.uX)(),(0,o.CE)("p",E,(0,i.v_)(e.uploadMessage),1)):(0,o.Q3)("",!0),e.uploadProgress>=0?((0,o.uX)(),(0,o.CE)("div",M,[(0,o.Lk)("p",null,"アップロード進捗: "+(0,i.v_)(e.uploadProgress)+"%",1),(0,o.Lk)("div",L,[(0,o.Lk)("div",{class:"bg-blue-500 text-white text-center p-1 rounded",style:(0,i.Tr)({width:e.uploadProgress+"%"})},(0,i.v_)(e.uploadProgress)+"% ",5)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",A,[t[37]||(t[37]=(0,o.Lk)("label",{for:"file-category",class:"mr-2"},"フィルター:",-1)),(0,o.bo)((0,o.Lk)("select",{id:"file-category","onUpdate:modelValue":t[16]||(t[16]=t=>e.selectedCategory=t),onChange:t[17]||(t[17]=(...t)=>e.filterFiles&&e.filterFiles(...t)),class:"border p-2"},t[36]||(t[36]=[(0,o.Fv)('<option value="all">すべて</option><option value="images">画像</option><option value="videos">ビデオ</option><option value="audio">オーディオ</option><option value="others">その他</option>',5)]),544),[[l.u1,e.selectedCategory]])]),t[39]||(t[39]=(0,o.Lk)("h2",{class:"text-xl mt-4 mb-2"},"ファイル・フォルダ一覧",-1)),(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.folders,(t=>((0,o.uX)(),(0,o.CE)("li",{key:t.name,class:"mb-2"},[(0,o.Lk)("span",{class:"text-blue-600 mr-2 cursor-pointer",onClick:s=>e.fetchFiles(t.path)}," 📁 "+(0,i.v_)(t.name),9,U),(0,o.Lk)("button",{class:"ml-2 bg-blue-500 text-white px-2 py-1",onClick:s=>e.openMoveModal(t.path)}," 移動 ",8,N),(0,o.Lk)("button",{class:"ml-2 bg-yellow-300 text-black px-2 py-1",onClick:s=>e.openRenameModal(t.path,t.name,"folder")}," リネーム ",8,X),(0,o.Lk)("button",{class:"ml-2 bg-red-500 text-white px-2 py-1",onClick:s=>e.deleteFolder(t.path)}," 削除 ",8,$)])))),128)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredFiles,(t=>((0,o.uX)(),(0,o.CE)("li",{key:t.name,class:"mb-2"},[(0,o.Lk)("a",{href:`${e.downloadUrl}/${encodeURIComponent(t.path)}${e.currentFolder?`?folder=${encodeURIComponent(e.currentFolder)}`:""}`,class:"text-blue-600 mr-2",download:""},(0,i.v_)(t.name),9,I),e.isMarkdown(t.name)||e.isText(t.name)?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:s=>e.openEditModal(t.path,t.name),class:"ml-2 bg-yellow-300 text-black px-2 py-1"}," 編集 ",8,T)):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"ml-2 bg-gray-300 text-black px-2 py-1",onClick:s=>e.previewFile(t.path)}," プレビュー ",8,S),(0,o.Lk)("button",{class:"ml-2 bg-blue-500 text-white px-2 py-1",onClick:s=>e.openMoveModal(t.path)}," 移動 ",8,P),(0,o.Lk)("button",{class:"ml-2 bg-yellow-300 text-black px-2 py-1",onClick:s=>e.openRenameModal(t.path,t.name,"file")}," リネーム ",8,R),(0,o.Lk)("button",{class:"ml-2 bg-red-500 text-white px-2 py-1",onClick:s=>e.confirmDelete(t.path)}," 削除 ",8,_)])))),128))])])):((0,o.uX)(),(0,o.CE)("div",d,[t[30]||(t[30]=(0,o.Lk)("h2",{class:"text-xl mb-2"},"ログイン",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.username=t),placeholder:"Username",class:"border p-2 mr-2",onKeyup:t[1]||(t[1]=(0,l.jR)(((...t)=>e.login&&e.login(...t)),["enter"]))},null,544),[[l.Jo,e.username]]),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.password=t),type:"password",placeholder:"Password",class:"border p-2 mr-2",onKeyup:t[3]||(t[3]=(0,l.jR)(((...t)=>e.login&&e.login(...t)),["enter"]))},null,544),[[l.Jo,e.password]]),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(...t)=>e.login&&e.login(...t)),class:"bg-blue-500 text-white px-4 py-2"},"ログイン"),e.loginError?((0,o.uX)(),(0,o.CE)("p",c,(0,i.v_)(e.loginError),1)):(0,o.Q3)("",!0)])),e.previewUrl?((0,o.uX)(),(0,o.CE)("div",j,[e.isImage(e.previewUrl)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.previewUrl,alt:"Preview",class:"border w-full"},null,8,O)):e.isVideo(e.previewUrl)?((0,o.uX)(),(0,o.CE)("video",{key:1,src:e.previewUrl,class:"border",width:"640",height:"360",controls:""},null,8,H)):e.isAudio(e.previewUrl)?((0,o.uX)(),(0,o.CE)("audio",{key:2,src:e.previewUrl,class:"border w-full",controls:""},null,8,z)):(0,o.Q3)("",!0),e.isText(e.previewUrl)?((0,o.uX)(),(0,o.CE)("div",{key:3,innerHTML:e.previewContent,class:"text-preview"},null,8,D)):(0,o.Q3)("",!0),e.previewUrl&&e.isMarkdown(e.previewUrl)?((0,o.uX)(),(0,o.CE)("div",{key:4,innerHTML:e.markdownHtml,class:"markdown-preview"},null,8,Q)):(0,o.Q3)("",!0),e.isPDF(e.previewUrl)?((0,o.uX)(),(0,o.CE)("iframe",{key:5,src:e.previewUrl,class:"border w-full",style:{height:"600px"},frameborder:"0"},null,8,V)):(0,o.Q3)("",!0),e.isExcel(e.previewUrl)?((0,o.uX)(),(0,o.CE)("div",Y,[Object.keys(e.sheets).length>0?((0,o.uX)(),(0,o.CE)("div",q,[t[40]||(t[40]=(0,o.Lk)("label",{for:"sheet-select",class:"mr-2"},"シートを選択:",-1)),(0,o.bo)((0,o.Lk)("select",{id:"sheet-select","onUpdate:modelValue":t[18]||(t[18]=t=>e.selectedSheet=t),onChange:t[19]||(t[19]=(...t)=>e.updateExcelTable&&e.updateExcelTable(...t))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sheets,((e,t)=>((0,o.uX)(),(0,o.CE)("option",{key:t,value:t},(0,i.v_)(t),9,K)))),128))],544),[[l.u1,e.selectedSheet]])])):(0,o.Q3)("",!0),(0,o.Lk)("div",J,[(0,o.Lk)("table",W,[(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[t[42]||(t[42]=(0,o.Lk)("th",{class:"row-number-header"},null,-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.excelColumns,((e,s)=>((0,o.uX)(),(0,o.CE)("th",{key:s,class:"column-header"},[(0,o.eW)((0,i.v_)(e)+" ",1),t[41]||(t[41]=(0,o.Lk)("div",{class:"resize-handle-horizontal"},null,-1))])))),128))])]),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.excelData,((e,s)=>((0,o.uX)(),(0,o.CE)("tr",{key:s},[(0,o.Lk)("td",B,(0,i.v_)(s+1),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e,((e,s)=>((0,o.uX)(),(0,o.CE)("td",{key:s,class:"cell"},[(0,o.eW)((0,i.v_)(e)+" ",1),t[43]||(t[43]=(0,o.Lk)("div",{class:"resize-handle-vertical"},null,-1))])))),128))])))),128))])])])])):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:t[20]||(t[20]=(...t)=>e.closePreview&&e.closePreview(...t)),class:"block mt-2 bg-red-500 text-white px-4 py-2"}," クローズ ")])):(0,o.Q3)("",!0),e.showRenameModal?((0,o.uX)(),(0,o.CE)("div",Z,[(0,o.Lk)("div",G,[(0,o.Lk)("h2",ee,"リネーム "+(0,i.v_)("folder"===e.renameType?"フォルダ":"ファイル"),1),(0,o.Lk)("p",null,"現在の名前: "+(0,i.v_)(e.renameOriginalName),1),t[44]||(t[44]=(0,o.Lk)("label",{for:"new-name"},"新しい名前:",-1)),(0,o.bo)((0,o.Lk)("input",{id:"new-name","onUpdate:modelValue":t[21]||(t[21]=t=>e.renameNewName=t),class:"border p-2 mb-4 w-full",placeholder:"Enter new name"},null,512),[[l.Jo,e.renameNewName]]),(0,o.Lk)("div",te,[(0,o.Lk)("button",{onClick:t[22]||(t[22]=(...t)=>e.cancelRename&&e.cancelRename(...t)),class:"bg-gray-500 text-white px-4 py-2 mr-2"},"キャンセル"),(0,o.Lk)("button",{onClick:t[23]||(t[23]=(...t)=>e.renameItem&&e.renameItem(...t)),class:"bg-green-500 text-white px-4 py-2"},"リネーム")])])])):(0,o.Q3)("",!0),e.showEditModal?((0,o.uX)(),(0,o.CE)("div",se,[(0,o.Lk)("div",le,[(0,o.Lk)("h2",null,(0,i.v_)(e.editFileName)+" を編集",1),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[24]||(t[24]=t=>e.editFileContent=t)},null,512),[[l.Jo,e.editFileContent]]),(0,o.Lk)("div",oe,[(0,o.Lk)("button",{class:"cancel-btn",onClick:t[25]||(t[25]=(...t)=>e.cancelEdit&&e.cancelEdit(...t))},"キャンセル"),(0,o.Lk)("button",{class:"save-btn",onClick:t[26]||(t[26]=(...t)=>e.saveFile&&e.saveFile(...t))},"保存")])])])):(0,o.Q3)("",!0),e.showMoveModal?((0,o.uX)(),(0,o.CE)("div",ae,[(0,o.Lk)("div",re,[t[46]||(t[46]=(0,o.Lk)("h2",{class:"text-xl font-bold mb-4"},"移動するファイル・フォルダ",-1)),(0,o.Lk)("p",ie,"ファイル・フォルダ: "+(0,i.v_)(e.selectedFileForMove),1),t[47]||(t[47]=(0,o.Lk)("label",{for:"move-folder"},"フォルダを選択してください:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[27]||(t[27]=t=>e.selectedMoveFolder=t),id:"move-folder",class:"border p-2 mb-4 w-full"},[t[45]||(t[45]=(0,o.Lk)("option",{value:""},"ルート",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.allFolders,(e=>((0,o.uX)(),(0,o.CE)("option",{key:e,value:e},(0,i.v_)(e),9,ne)))),128))],512),[[l.u1,e.selectedMoveFolder]]),(0,o.Lk)("div",de,[(0,o.Lk)("button",{onClick:t[28]||(t[28]=(...t)=>e.cancelMove&&e.cancelMove(...t)),class:"bg-gray-500 text-white px-4 py-2 mr-2"},"キャンセル"),(0,o.Lk)("button",{onClick:t[29]||(t[29]=(...t)=>e.moveFile&&e.moveFile(...t)),class:"bg-green-500 text-white px-4 py-2"},"実行")])])])):(0,o.Q3)("",!0)])}s(4114),s(8992),s(4520),s(3949),s(1454),s(8872);var he=s(4373);he.A.defaults.baseURL="https://sharefiles.ddns.net";const ue=async(e,t)=>{const s=await he.A.post("/login",{username:e,password:t});if(200===s.status)return s.data;throw new Error(s.data.message||"Login failed.")},pe=(e,t,s)=>{const l=new FormData;return l.append("file",e),t&&l.append("folder",t),he.A.post("/upload",l,{onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);s&&s(t)}})},me=(e="")=>he.A.get("/files"+(e?`?folder=${encodeURIComponent(e)}`:""));async function we(e){try{const t=await he.A.delete("/delete",{data:{path:e}});return t.data}catch(t){throw console.error("Failed to delete file:",t),t}}async function fe(e){try{const t=await he.A.delete("/delete",{data:{path:e}});return t.data}catch(t){throw console.error("Failed to delete folder:",t),t}}const ge=e=>he.A.post("/create-folder",e),ve=async()=>{const e=await he.A.get("/api/user"),t=await he.A.get("/api/system-updates");return{user:e.data,updates:t.data.content}},ye=async e=>{const t=await he.A.post("/api/system-updates",{content:e});return t.data},be=async(e,t,s)=>{const l=await he.A.post("/rename",{path:e,new_name:t,type:s});return l.data},ke=async(e,t)=>{const s=await he.A.post("/move",{src_path:e,dest_folder:t});return s.data};var Fe=s(1741),Ce=s(1450),xe={data(){return{username:"",password:"",loggedIn:!1,loginError:"",files:[],folders:[],allFolders:[],filteredFiles:[],selectedFile:null,uploadMessage:"",folderMessage:"",previewUrl:"",previewContent:"",downloadUrl:"https://sharefiles.ddns.net/download",selectedCategory:"all",currentFolder:"",selectedUploadFolder:"",newFolderName:"",uploadProgress:-1,showMoveModal:!1,selectedFileForMove:"",selectedMoveFolder:"",showRenameModal:!1,renameItemPath:"",renameOriginalName:"",renameNewName:"",renameType:"",showNewYear:!1,showExcelModal:!1,excelData:[],excelColumns:[],sheets:{},selectedSheet:"",updateContent:"",isAdmin:!1,isEditMode:!1,renderedHtml:"",showEditModal:!1,editFileContent:"",editFileName:"",editFilePath:""}},async mounted(){try{this.loggedIn=!1,this.isAdmin=!1;const e=await this.checkSession();e.loggedIn&&(this.loggedIn=!0,this.username=e.username,this.currentFolder||(this.currentFolder=""),await this.fetchFiles(this.currentFolder),this.allFolders=await this.getAllFolders());const t=new Date;0===t.getMonth()&&1===t.getDate()?(this.showNewYear=!0,console.log("New Year Event Triggered:",this.showNewYear),setTimeout((()=>{this.showNewYear=!1}),1e4)):console.log("New Year Event Not Triggered. Current Date:",t),this.loggedIn&&await this.fetchUserAndUpdates()}catch(e){console.error("Session check failed or API error occurred:",e),this.isAdmin=!1,this.loggedIn=!1}},methods:{skipNewYear(){this.showNewYear=!1,console.log("New Year Event Manually Skipped")},async login(){try{await ue(this.username,this.password),this.loggedIn=!0,this.loginError="",await this.fetchFiles(),await this.fetchUserAndUpdates()}catch(e){this.loginError=e.response?.data?.message||"Login failed."}},async fetchUserAndUpdates(){try{const{user:e,updates:t}=await ve();this.isAdmin="admin"===e.role,t?(this.updateContent=t,await this.renderMarkdown()):(this.updateContent="No updates available.",this.renderedHtml="No updates available.")}catch(e){console.error("Error fetching user or updates:",e),this.isAdmin=!1,this.updateContent="No updates available.",this.renderedHtml="No updates available."}},async checkSession(){try{const e=await he.A.get("/session");return e.data}catch(e){return console.error("Session Check Failed:",e.response?.data||e),{loggedIn:!1}}},toggleEditMode(){this.isAdmin?this.isEditMode=!this.isEditMode:alert("権限がありません。")},async saveUpdate(){try{await ye(this.updateContent),alert("保存が完了しました。"),this.isEditMode=!1}catch(e){console.error("Error saving update:",e),alert("保存に失敗しました。もう一度試してください。")}},async openEditModal(e,t){try{const s=await he.A.get(`/download/${encodeURIComponent(e)}`,{responseType:"text"});this.editFileContent=s.data,this.editFileName=t,this.editFilePath=e,this.showEditModal=!0}catch(s){console.error("Failed to load file content for editing:",s),alert("ファイルの読み込みに失敗しました。")}},cancelEdit(){this.showEditModal=!1,this.editFileContent="",this.editFileName="",this.editFilePath=""},async saveFile(){try{await he.A.post("/api/save-file",{path:this.editFilePath,content:this.editFileContent}),alert("ファイルが保存されました。"),this.cancelEdit()}catch(e){console.error("Failed to save file:",e),alert("ファイルの保存に失敗しました。")}},async logout(){try{await he.A.post("/logout"),this.loggedIn=!1,this.username="",this.isAdmin=!1,this.isEditMode=!1,this.updateContent="",this.previewUrl="",this.selectedFile=null,this.folders=[],this.files=[],this.allFolders=[],this.uploadMessage="",this.folderMessage="",this.selectedCategory="all",this.currentFolder="",this.selectedUploadFolder="",this.selectedFileForMove="",this.selectedMoveFolder="",this.uploadProgress=-1,this.showExcelModal=!1,this.excelData=[],this.excelColumns=[]}catch(e){console.error("Logout failed:",e)}},watch:{loggedIn(e){e?this.fetchUserAndUpdates():(this.isAdmin=!1,this.updateContent="No updates available.",this.renderMarkdown())}},async fetchFiles(e=""){try{const t=await me(e);this.folders=t.data.folders||[],this.files={images:t.data.files.filter((e=>this.isImage(e.name))),videos:t.data.files.filter((e=>this.isVideo(e.name))),audio:t.data.files.filter((e=>this.isAudio(e.name))),others:t.data.files.filter((e=>!(this.isImage(e.name)||this.isVideo(e.name)||this.isAudio(e.name))))},this.currentFolder=e,this.filterFiles()}catch(t){console.error("Failed to fetch files:",t),this.folders=[],this.files={images:[],videos:[],audio:[],others:[]},this.filteredFiles=[]}},async createFolder(){if(!this.newFolderName)return this.folderMessage="フォルダ名を入力してください。",void this.clearMessageAfterDelay("folderMessage");try{const e=await ge({foldername:this.newFolderName,base_folder:this.currentFolder||""});this.folderMessage=e.message,await this.fetchFiles(this.currentFolder),this.allFolders=await this.getAllFolders(),this.clearMessageAfterDelay("folderMessage")}catch(e){e.response&&409===e.response.status?this.folderMessage=`Folder '${this.newFolderName}' already exists.`:this.folderMessage="フォルダの作成に失敗しました。",this.clearMessageAfterDelay("folderMessage")}},clearMessageAfterDelay(e,t=5e3){setTimeout((()=>{this[e]=""}),t)},goToParent(){if(this.currentFolder){const e=this.currentFolder.split("/").slice(0,-1).join("/");this.fetchFiles(e)}},async uploadFile(){if(this.selectedFile){this.uploadProgress=0;try{const e=await pe(this.selectedFile,this.selectedUploadFolder||"",(e=>{this.uploadProgress=e,console.log(`Upload progress: ${e}%`)}));this.uploadMessage=e.data.message||"アップロードが完了しました。",this.selectedFile=null,this.$refs.fileInput.value="",this.selectedUploadFolder="",this.uploadProgress=-1,await this.fetchFiles(this.currentFolder),setTimeout((()=>{this.uploadMessage=""}),5e3)}catch(e){console.error("Error during file upload:",e),this.uploadMessage=e.response?.data?.message||"アップロードに失敗しました。",this.uploadProgress=-1}}else this.uploadMessage="初めにファイルを選択してください。"},async deleteFolder(e){if(confirm(`"${e}" を削除しますか？`)){this.folders=this.folders.filter((t=>t.path!==e));try{const t=await fe(e);alert(t.message),await this.fetchFiles(this.currentFolder),this.allFolders=await this.getAllFolders()}catch(t){console.error("Failed to delete folder:",t),alert("削除に失敗しました。")}}},resetTableStyles(){const e=document.querySelector("#excelTable");if(e){const t=e.querySelectorAll("th");t.forEach((e=>{e.style.width=""}));const s=e.querySelectorAll("tr");s.forEach((e=>{e.style.height=""}))}},async previewExcel(e){try{this.resetTableStyles();const t=await he.A.get(`/download/${encodeURIComponent(e)}`,{responseType:"blob"}),s=await t.data.arrayBuffer(),l=Ce.LF(s,{type:"array"});this.sheets=l.SheetNames.reduce(((e,t)=>{const s=Ce.Wp.sheet_to_json(l.Sheets[t],{header:1});return e[t]=s,e}),{}),this.selectedSheet=l.SheetNames[0],this.updateExcelTable(),this.showExcelModal=!0}catch(t){console.error("Excelファイルのプレビューに失敗しました。:",t),alert("Excelファイルのプレビューに失敗しました。")}},generateExcelColumns(e){const t=[];for(let s=0;s<e;s++){let e="",l=s;do{e=String.fromCharCode(l%26+65)+e,l=Math.floor(l/26)-1}while(l>=0);t.push(e)}return t},updateExcelTable(){if(this.selectedSheet&&this.sheets[this.selectedSheet]){const e=this.sheets[this.selectedSheet],t=Math.max(e.length,20),s=Math.max(...e.map((e=>e.length)),17);this.excelColumns=this.generateExcelColumns(s),this.excelData=Array.from({length:t},((t,l)=>Array.from({length:s},((t,s)=>e[l]?.[s]||"")))),setTimeout((()=>this.enableResizableCells()),0)}},enableResizableCells(){const e=document.querySelector("#excelTable");if(!e)return;const t=e.querySelectorAll("th");t.forEach((e=>{const t=document.createElement("div");t.className="resize-handle-horizontal",t.addEventListener("mousedown",this.startColumnResize),e.appendChild(t)}));const s=e.querySelectorAll("tr");s.forEach((e=>{const t=e.querySelector(".row-number");if(t){const e=document.createElement("div");e.className="resize-handle-vertical",e.addEventListener("mousedown",this.startRowResize),t.appendChild(e)}}));const l=e.querySelectorAll("td");l.forEach((e=>{const t=document.createElement("div");t.className="resize-handle-horizontal",t.addEventListener("mousedown",(t=>this.startColumnResize(t,e))),e.appendChild(t);const s=document.createElement("div");s.className="resize-handle-vertical",s.addEventListener("mousedown",(t=>this.startRowResize(t,e))),e.appendChild(s)}))},startColumnResize(e,t=null){const s=t||e.target.parentElement,l=s.closest("table"),o=e.pageX,a=Array.from(s.parentElement.children).indexOf(s),r=s.offsetWidth;let i;document.body.classList.add("dragging");const n=e=>{const t=Math.max(r+(e.pageX-o),30);i||(i=requestAnimationFrame((()=>{l.querySelectorAll(`td:nth-child(${a+1}), th:nth-child(${a+1})`).forEach((e=>e.style.width=`${t}px`)),i=null})))},d=()=>{document.body.classList.remove("dragging"),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",d),i&&cancelAnimationFrame(i)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",d)},startRowResize(e,t=null){const s=t?t.parentElement:e.target.closest("tr"),l=s.closest("table"),o=e.pageY,a=Array.from(s.parentElement.children).indexOf(s),r=s.offsetHeight;let i;document.body.classList.add("dragging");const n=e=>{const t=Math.max(20,r+(e.pageY-o));i||(i=requestAnimationFrame((()=>{l.querySelectorAll(`tr:nth-child(${a+1}) td, tr:nth-child(${a+1}) th`).forEach((e=>e.style.height=`${t}px`)),i=null})))},d=()=>{document.body.classList.remove("dragging"),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",d),i&&cancelAnimationFrame(i)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",d)},async previewFile(e){try{const t=encodeURIComponent(e.replace(/\\/g,"/"));if(this.previewUrl=`${this.downloadUrl}/${t}`,console.log(`Sending preview request to: ${this.previewUrl}`),this.isMarkdown(e))await this.previewMarkdown(e);else if(this.isExcel(e))await this.previewExcel(e);else if(this.isText(e)){const e=await he.A.get(this.previewUrl,{responseType:"text"});this.previewContent=this.embedVideos(e.data)}else{const e=await he.A.get(this.previewUrl);console.log("Preview response:",e)}}catch(t){console.error("Failed to preview file:",t),alert(`プレビュー中にエラーが発生しました。: ${t.message}`)}},renderMarkdown:async function(){try{if(!this.updateContent||""===this.updateContent.trim())return void(this.renderedHtml="");const e=this.embedVideos(this.updateContent),t="string"===typeof e?e:"",s=new Fe.xI.Renderer;s.list=function(e,t){const s=t?"ol":"ul";return`<${s}>${e}</${s}>`},Fe.xI.setOptions({breaks:!0,gfm:!0,tables:!0,renderer:s}),this.renderedHtml=(0,Fe.xI)(t)}catch(e){console.error("renderMarkdown: Error rendering Markdown content:",e)}},async previewMarkdown(e){try{this.previewContent="",this.markdownHtml="";const t=await he.A.get(`/download/${encodeURIComponent(e)}`,{responseType:"text"}),s="string"===typeof t.data?t.data:"",l=new Fe.xI.Renderer;l.link=function(e,t,s){const l="string"===typeof e?e:e?.href||"";if(l){const e=/(https?:\/\/(?:www\.)?youtube\.com\/watch\?v=|https?:\/\/youtu\.be\/)([\w-]+)/,t=l.match(e);if(t){const e=t[2];return`\n                    <div class="youtube-container">\n                        <iframe width="560" height="315" src="https://www.youtube.com/embed/${e}" frameborder="0" allowfullscreen></iframe>\n                    </div>`}const s=/(https?:\/\/(?:www\.)?nicovideo\.jp\/watch\/)([a-zA-Z0-9]+)/,o=l.match(s);if(o){const e=o[2];return`\n                    <div class="nicovideo-container">\n                        <iframe width="560" height="315" src="https://embed.nicovideo.jp/watch/${e}" frameborder="0" allowfullscreen></iframe>\n                    </div>`}}return`<a href="${l}" title="${t||""}">${s||l}</a>`},Fe.xI.setOptions({breaks:!0,gfm:!0,tables:!0,renderer:l}),this.markdownHtml=(0,Fe.xI)(s),this.previewUrl=e}catch(t){console.error("previewMarkdown: Error previewing Markdown file:",t),alert("Markdown プレビューに失敗しました。")}},embedVideos(e){const t=/(https?:\/\/(?:www\.)?(?:youtube\.com\/(?:watch\?v=|live\/)|youtu\.be\/))([\w-]+)/g,s=/(https?:\/\/(?:www\.|)nicovideo\.jp\/watch\/)([a-z0-9]+)/g;return e=e.replace(t,((e,t,s)=>`\n        <div class="video-container">\n            <iframe \n                src="https://www.youtube.com/embed/${s}" \n                frameborder="0" \n                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" \n                allowfullscreen>\n            </iframe>\n        </div>`)),e=e.replace(s,((e,t,s)=>`\n        <div class="video-container">\n            <iframe \n                src="https://embed.nicovideo.jp/watch/${s}" \n                frameborder="0" \n                allowfullscreen>\n            </iframe>\n        </div>`)),e},downloadFile(e){const t=encodeURIComponent(e.replace(/\\/g,"/")),s=`${this.downloadUrl}/${t}`;window.open(s,"_blank")},closePreview(){this.previewUrl="",this.previewContent="",this.showExcelModal=!1,this.excelData=[],this.excelColumns=[]},confirmDelete(e){confirm(`${e}を削除してよろしいですか？`)&&this.deleteFile(e)},async getAllFolders(e=""){try{const t=await me(e),s=t.data.folders||[];let l=s.map((t=>e?`${e}/${t.name}`:t.name));for(const o of s){const t=e?`${e}/${o.name}`:o.name,s=await this.getAllFolders(t);l=l.concat(s)}return l}catch(t){return console.error("Failed to fetch all folders:",t),alert("一覧の取得に失敗しました。更新を試してください。"),[]}},openMoveModal(e){this.selectedFileForMove=e,this.showMoveModal=!0},cancelMove(){this.selectedFileForMove="",this.selectedMoveFolder="",this.showMoveModal=!1,console.log("Move modal canceled and state cleared.")},openRenameModal(e,t,s){this.renameItemPath=e,this.renameType=s,this.renameOriginalName=t,this.renameNewName="file"===s?t.replace(/\.[^/.]+$/,""):t,this.showRenameModal=!0},cancelRename(){this.renameItemPath="",this.renameOriginalName="",this.renameNewName="",this.renameType="",this.showRenameModal=!1},async renameItem(){try{const e="file"===this.renameType?`${this.renameNewName}.${this.renameOriginalName.split(".").pop()}`:this.renameNewName;await be(this.renameItemPath,e,this.renameType),alert("リネームが完了しました。"),this.cancelRename(),this.fetchFiles(this.currentFolder)}catch(e){console.error("Error renaming item:",e),alert("リネームに失敗しました。")}},async moveFile(){try{await ke(this.selectedFileForMove,this.selectedMoveFolder),alert("移動が完了しました。"),this.cancelMove(),this.fetchFiles(this.currentFolder)}catch(e){console.error("Error moving file:",e),alert("移動に失敗しました。")}},onFileChange(e){this.selectedFile=e.target.files[0],this.selectedFile&&console.log("Selected file:",this.selectedFile.name)},async deleteFile(e){try{const t=await we(e);alert(t.message),await this.fetchFiles(this.currentFolder)}catch(t){console.error("Failed to delete file:",t),alert("削除に失敗しました。")}},filterFiles(){"all"===this.selectedCategory?this.filteredFiles=Object.values(this.files).flat():this.filteredFiles=this.files[this.selectedCategory]||[]},isImage(e){return/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(e)},isVideo(e){return/\.(mp4|webm|ogg)$/i.test(e)},isAudio(e){return/\.(mp3|wav|flac|ogg)$/i.test(e)},isText(e){return/\.txt$/i.test(e)},isMarkdown(e){return/\.(md|markdown)$/i.test(e)},isExcel(e){return/\.(xlsx|xls)$/i.test(e)},isPDF(e){return/\.pdf$/i.test(e)}}},Ee=s(1241);const Me=(0,Ee.A)(xe,[["render",ce]]);var Le=Me,Ae={name:"App",components:{FileManager:Le}};const Ue=(0,Ee.A)(Ae,[["render",r]]);var Ne=Ue;(0,l.Ef)(Ne).mount("#app")}},t={};function s(l){var o=t[l];if(void 0!==o)return o.exports;var a=t[l]={exports:{}};return e[l].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,l,o,a){if(!l){var r=1/0;for(c=0;c<e.length;c++){l=e[c][0],o=e[c][1],a=e[c][2];for(var i=!0,n=0;n<l.length;n++)(!1&a||r>=a)&&Object.keys(s.O).every((function(e){return s.O[e](l[n])}))?l.splice(n--,1):(i=!1,a<r&&(r=a));if(i){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[l,o,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var l in t)s.o(t,l)&&!s.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,l){var o,a,r=l[0],i=l[1],n=l[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(n)var c=n(s)}for(t&&t(l);d<r.length;d++)a=r[d],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(c)},l=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=s.O(void 0,[504],(function(){return s(7242)}));l=s.O(l)})();
//# sourceMappingURL=app.7f65f69c.js.map